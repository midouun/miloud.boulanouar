/* --- المتغيرات العامة --- */
:root {
    --bg-dark: #0f172a;
    --ladder-color: #475569;
    --char-skin: #fca5a5;
    --char-clothes: #3b82f6;
    --bulb-off: #333;
    --bulb-on: #fbbf24;
    
    /* متغيرات الثيمات (سيتم تغييرها ب JS) */
    --theme-bg: #f8fafc;
    --theme-text: #1e293b;
    --theme-primary: #1e3a8a;
    --theme-card: #ffffff;
}

body { margin: 0; font-family: 'Cairo', sans-serif; overflow: hidden; background: var(--bg-dark); }

/* ================= المرحلة 1: المشهد ================= */
.scene-container {
    position: fixed; width: 100%; height: 100vh;
    background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
    z-index: 1000; transition: transform 1s cubic-bezier(0.86, 0, 0.07, 1);
}

.darkness-overlay {
    position: absolute; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85); /* ظلام دامس */
    transition: background 1.5s ease; z-index: 5;
    pointer-events: none;
}
.scene-container.lit .darkness-overlay { background: rgba(0,0,0,0.1); } /* إضاءة */

/* السقف واللمبة */
.ceiling-fixture {
    position: absolute; top: 0; left: 50%; transform: translateX(-50%);
    z-index: 6; display: flex; flex-direction: column; align-items: center;
}
.wire { width: 2px; height: 100px; background: #555; }
.bulb-socket { width: 20px; height: 15px; background: #222; border-radius: 2px; }
.bulb {
    width: 50px; height: 50px; background: var(--bulb-off);
    border-radius: 50%; margin-top: -2px;
    transition: 0.3s; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.8);
}
.bulb.on {
    background: var(--bulb-on);
    box-shadow: 0 0 60px var(--bulb-on), 0 0 120px rgba(251, 191, 36, 0.5);
}

/* خيط السحب */
.pull-string {
    position: absolute; top: 120px; right: -15px;
    display: flex; flex-direction: column; align-items: center;
    transform-origin: top center; transition: transform 0.2s;
}
.string-line { width: 1px; height: 80px; background: #888; }
.string-handle { width: 8px; height: 12px; background: #aaa; border-radius: 4px; }
.pull-string.pulled { transform: scaleY(1.3); } /* تمدد عند السحب */

/* السلم */
.ladder-container {
    position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 60px; height: 80vh; z-index: 4;
}
.rail { width: 6px; background: var(--ladder-color); position: absolute; top: 0; bottom: 0; border-radius: 4px; }
.rail.left { left: 0; } .rail.right { right: 0; }
.rung {
    height: 4px; background: var(--ladder-color); margin-top: 40px;
    border-radius: 2px; width: 100%;
}

/* الشخصية المتسلقة */
.character {
    position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
    width: 40px; height: 90px; z-index: 10;
    transition: bottom 0.1s linear; /* حركة ناعمة */
}
.char-head {
    width: 20px; height: 20px; background: var(--char-skin);
    border-radius: 50%; margin: 0 auto; z-index: 2; position: relative;
}
.char-body {
    width: 24px; height: 35px; background: var(--char-clothes);
    margin: -2px auto 0; border-radius: 4px; position: relative; z-index: 1;
}
.backpack {
    width: 18px; height: 25px; background: #78350f;
    position: absolute; top: 5px; left: 50%; transform: translateX(-50%);
    border-radius: 4px; z-index: -1;
}
/* الأطراف */
.arm, .leg { width: 6px; position: absolute; background: var(--char-clothes); border-radius: 3px; transform-origin: top center; }
.arm { height: 25px; top: 22px; background: #2563eb; } /* لون أغمق قليلاً */
.left-arm { left: 0; } .right-arm { right: 0; }
.leg { height: 30px; top: 52px; background: #1d4ed8; }
.left-leg { left: 4px; } .right-leg { right: 4px; }

/* أنيميشن التسلق */
.climbing .left-arm { animation: climbLimb 0.8s infinite alternate; }
.climbing .right-arm { animation: climbLimb 0.8s infinite alternate-reverse; }
.climbing .left-leg { animation: climbLimb 0.8s infinite alternate-reverse; }
.climbing .right-leg { animation: climbLimb 0.8s infinite alternate; }

@keyframes climbLimb { from { transform: rotate(-20deg) translateY(-2px); } to { transform: rotate(20deg) translateY(2px); } }

/* أنيميشن سحب الخيط (اليد اليمنى) */
.reaching-arm {
    transform: rotate(-140deg) !important; /* رفع اليد للأعلى */
    height: 35px !important;
    transition: transform 0.5s;
}
.pulling-arm {
    transform: rotate(-140deg) translateY(10px) !important; /* سحب للأسفل */
    transition: transform 0.2s;
}

/* زر التحكم */
.start-control {
    position: absolute; bottom: 50px; width: 100%; text-align: center; z-index: 20;
}
.btn-start {
    background: #10b981; color: white; border: none; padding: 15px 30px;
    font-size: 1.2rem; border-radius: 30px; cursor: pointer; font-family: 'Cairo';
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); transition: transform 0.2s;
}
.btn-start:hover { transform: scale(1.05); }

/* الباب السري وزر الفكرة */
.secret-door {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    z-index: 15; opacity: 0; transition: opacity 1s;
}
.secret-door.visible { opacity: 1; }
.thought-btn {
    background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px); padding: 30px 60px; border-radius: 20px;
    cursor: pointer; color: white; transition: 0.3s;
}
.thought-btn:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.05); }
.glowing-icon { font-size: 3rem; color: #fbbf24; display: block; margin-bottom: 10px; filter: drop-shadow(0 0 8px #fbbf24); }
.btn-content span { font-size: 2rem; font-family: 'Amiri'; font-weight: bold; }

/* ================= المرحلة 2: المودال ================= */
.modal-backdrop {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); z-index: 2000;
    display: flex; justify-content: center; align-items: center;
    backdrop-filter: blur(5px);
}
.modal-content {
    background: white; width: 90%; max-width: 450px; border-radius: 16px;
    overflow: hidden; animation: slideUp 0.4s ease-out;
}
.modal-header { background: #f1f5f9; padding: 20px; text-align: center; border-bottom: 1px solid #e2e8f0; }
.modal-header h3 { margin: 0; color: #1e3a8a; }
.form-body { padding: 20px; }
.input-group { position: relative; margin-bottom: 15px; }
.input-group i { position: absolute; right: 15px; top: 15px; color: #64748b; }
.input-group input, .input-group textarea {
    width: 100%; padding: 12px 40px 12px 12px; border: 1px solid #cbd5e1;
    border-radius: 8px; font-family: 'Cairo'; box-sizing: border-box; outline: none;
}
.input-group input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
.modal-footer { padding: 20px; text-align: center; }
.btn-save {
    width: 100%; background: #2563eb; color: white; border: none; padding: 12px;
    border-radius: 8px; cursor: pointer; font-weight: bold; font-family: 'Cairo';
}

/* ================= المرحلة 3: الأسئلة (احترافية) ================= */
.psych-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #0f172a; z-index: 3000; display: flex; justify-content: center; align-items: center;
}
.psych-card {
    width: 90%; max-width: 600px;
    background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px); padding: 40px; border-radius: 24px;
    text-align: center; color: white; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
}
.psych-progress { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
.bar-bg { width: 80%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; }
.bar-fill { width: 0%; height: 100%; background: #38bdf8; border-radius: 3px; transition: width 0.5s; }
.question-area h2 { font-size: 1.8rem; margin-bottom: 40px; font-family: 'Amiri'; line-height: 1.5; }
.options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.opt-btn {
    background: transparent; border: 1px solid rgba(255,255,255,0.2);
    color: #cbd5e1; padding: 20px; border-radius: 16px; cursor: pointer;
    font-family: 'Cairo'; font-size: 1.1rem; transition: 0.3s;
}
.opt-btn:hover { background: #38bdf8; color: #0f172a; border-color: #38bdf8; transform: translateY(-5px); }

/* ================= المرحلة 4: المنصة ================= */
.platform-wrapper {
    background: var(--theme-bg); color: var(--theme-text);
    min-height: 100vh; overflow-y: auto;
}
.official-header {
    background: var(--theme-card); padding: 20px; border-bottom: 4px solid var(--theme-primary);
    text-align: center; font-family: 'Amiri';
}
.university-banner {
    margin-top: 20px; border: 2px solid var(--theme-primary); padding: 20px;
    display: inline-flex; align-items: center; gap: 20px; border-radius: 12px;
}
.uni-logo { font-size: 3.5rem; color: var(--theme-primary); }
.uni-text h1 { font-size: 1.5rem; margin: 0; color: var(--theme-primary); }
.student-bar {
    background: var(--theme-primary); color: white; padding: 15px 5%;
    display: flex; justify-content: space-between;
}
.grid-sections {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px; padding: 40px 5%; max-width: 1200px; margin: 0 auto;
}
.section-card {
    background: var(--theme-card); padding: 30px; border-radius: 16px;
    text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer;
    transition: 0.3s; border: 1px solid transparent;
}
.section-card:hover { transform: translateY(-5px); border-color: var(--theme-primary); }
.icon-circle {
    width: 60px; height: 60px; background: rgba(0,0,0,0.05); border-radius: 50%;
    display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;
    font-size: 1.5rem; color: var(--theme-primary);
}

/* فئات مساعدة */
.hidden { display: none !important; }
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

/* ألوان الثيمات (تضاف للكلاسات في body) */
body.official { --theme-bg: #f0f9ff; --theme-primary: #1e3a8a; --theme-card: #fff; }
body.dark { --theme-bg: #0f172a; --theme-primary: #38bdf8; --theme-card: #1e293b; --theme-text: #fff; }
body.calm { --theme-bg: #f0fdf4; --theme-primary: #15803d; --theme-card: #fff; }
body.reader { --theme-bg: #fdf6e3; --theme-primary: #78350f; --theme-card: #fffbeb; }
